<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15alpha" />
		<meta name="keywords" content="Maildir,Articles lacking reliable references from April 2009,Articles needing additional references from April 2009,Articles with unsourced statements since June 2008,Fact,*nix,Atomic operations,Balsa (e-mail client),Beagle (software),Claws Mail,Clobber (computing)" />
		<link rel="alternate" type="application/x-wiki" title="Edit this page" href="/w/index.php?title=Maildir&amp;action=edit" />
		<link rel="edit" title="Edit this page" href="/w/index.php?title=Maildir&amp;action=edit" />
		<link rel="apple-touch-icon" href="http://en.wikipedia.org/apple-touch-icon.png" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (en)" />
		<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html" />
		<link rel="alternate" type="application/rss+xml" title="Wikipedia RSS Feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="Wikipedia Atom Feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>Maildir - Wikipedia, the free encyclopedia</title>
		<link rel="stylesheet" href="/skins-1.5/common/shared.css?207xx" type="text/css" media="screen" />
		<link rel="stylesheet" href="/skins-1.5/common/commonPrint.css?207xx" type="text/css" media="print" />
		<link rel="stylesheet" href="/skins-1.5/monobook/main.css?207xx" type="text/css" media="screen" />
		<link rel="stylesheet" href="/skins-1.5/chick/main.css?207xx" type="text/css" media="handheld" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins-1.5/monobook/IE50Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/skins-1.5/monobook/IE55Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/skins-1.5/monobook/IE60Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/skins-1.5/monobook/IE70Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" />
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" media="print" />
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Handheld.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" media="handheld" />
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" />
		<link rel="stylesheet" href="/w/index.php?title=-&amp;action=raw&amp;maxage=2678400&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="/skins-1.5/common/IEFixes.js?207xx"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/skins-1.5";
		var wgArticlePath = "/wiki/$1";
		var wgScriptPath = "/w";
		var wgScript = "/w/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://en.wikipedia.org";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Maildir";
		var wgTitle = "Maildir";
		var wgAction = "view";
		var wgArticleId = "60067";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 281862247;
		var wgVersion = "1.15alpha";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgMWSuggestTemplate = "http://en.wikipedia.org/w/api.php?action=opensearch\x26search={searchTerms}\x26namespace={namespaces}\x26suggest";
		var wgDBname = "enwiki";
		var wgSearchNamespaces = [0];
		var wgMWSuggestMessages = ["with suggestions", "no suggestions"];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="/skins-1.5/common/wikibits.js?207xx"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="/skins-1.5/common/ajax.js?207xx"></script>
		<script type="text/javascript" src="/skins-1.5/common/mwsuggest.js?207xx"></script>
<script type="text/javascript">/*<![CDATA[*/
var wgNotice='';var wgNoticeLocal='';
/*]]>*/</script>		<script type="text/javascript" src="http://upload.wikimedia.org/centralnotice/wikipedia/en/centralnotice.js?207xx"></script>
		<script type="text/javascript" src="/w/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Maildir skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
		<div id="siteNotice"><script type='text/javascript'>if (wgNotice != '') document.writeln(wgNotice);</script></div>		<h1 id="firstHeading" class="firstHeading">Maildir</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<table class="metadata plainlinks ambox ambox-content" style="">
<tr>
<td class="mbox-image">
<div style="width: 52px;"><a href="/wiki/File:Question_book-new.svg" class="image" title="Question book-new.svg"><img alt="" src="http://upload.wikimedia.org/wikipedia/en/thumb/9/99/Question_book-new.svg/50px-Question_book-new.svg.png" width="50" height="39" border="0" /></a></div>
</td>
<td class="mbox-text" style="">This article <b>needs <a href="/wiki/Wikipedia:Verifiability" title="Wikipedia:Verifiability">references</a> that appear in reliable third-party publications</b>. <a href="/wiki/Wikipedia:No_original_research#Primary.2C_secondary.2C_and_tertiary_sources" title="Wikipedia:No original research">Primary sources</a> or sources affiliated with the subject are generally not sufficient for a Wikipedia article. Please add more appropriate <a href="/wiki/Wikipedia:Citing_sources" title="Wikipedia:Citing sources">citations</a> from <a href="/wiki/Wikipedia:Reliable_sources" title="Wikipedia:Reliable sources">reliable sources</a>. <small><i>(April 2009)</i></small></td>
</tr>
</table>
<table class="metadata plainlinks ambox ambox-content" style="">
<tr>
<td class="mbox-image">
<div style="width: 52px;"><a href="/wiki/File:Question_book-new.svg" class="image" title="Question book-new.svg"><img alt="" src="http://upload.wikimedia.org/wikipedia/en/thumb/9/99/Question_book-new.svg/50px-Question_book-new.svg.png" width="50" height="39" border="0" /></a></div>
</td>
<td class="mbox-text" style="">This article <b>needs additional <a href="/wiki/Wikipedia:Citing_sources" title="Wikipedia:Citing sources">citations</a> for <a href="/wiki/Wikipedia:Verifiability" title="Wikipedia:Verifiability">verification</a>.</b> Please help <a href="http://en.wikipedia.org/w/index.php?title=Maildir&amp;action=edit" class="external text" title="http://en.wikipedia.org/w/index.php?title=Maildir&amp;action=edit" rel="nofollow">improve this article</a> by adding <a href="/wiki/Wikipedia:Reliable_sources" title="Wikipedia:Reliable sources">reliable references</a> (ideally, using <i><a href="/wiki/Wikipedia:Footnotes" title="Wikipedia:Footnotes">inline citations</a></i>). Unsourced material may be <a href="/wiki/Template:Fact" title="Template:Fact">challenged</a> and <a href="/wiki/Wikipedia:BURDEN" title="Wikipedia:BURDEN" class="mw-redirect">removed</a>. <small><i>(April 2009)</i></small></td>
</tr>
</table>
<p><b>Maildir</b> is a widely-used format for storing <a href="/wiki/E-mail" title="E-mail">e-mail</a> that does not require application-level <a href="/wiki/File_locking" title="File locking">file locking</a> to maintain message integrity as messages are added, moved and deleted. Each message is kept in a separate <a href="/wiki/Computer_file" title="Computer file">file</a> with a unique name. All changes are made using <a href="/wiki/Atomic_operations" title="Atomic operations" class="mw-redirect">atomic filesystem operations</a> so that the <a href="/wiki/Filesystem" title="Filesystem" class="mw-redirect">filesystem</a> handles <a href="/wiki/File_locking" title="File locking">file locking</a> concurrency issues. A Maildir is a <a href="/wiki/Directory_(file_systems)" title="Directory (file systems)">directory</a> (often named <code>Maildir</code>) with three subdirectories named <code>tmp</code>, <code>new</code>, and <code>cur</code>.</p>
<table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="#Specifications"><span class="tocnumber">1</span> <span class="toctext">Specifications</span></a>
<ul>
<li class="toclevel-2"><a href="#Maildir"><span class="tocnumber">1.1</span> <span class="toctext">Maildir</span></a></li>
<li class="toclevel-2"><a href="#Maildir.2B.2B"><span class="tocnumber">1.2</span> <span class="toctext">Maildir++</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Problem_space_addressed_by_Maildir"><span class="tocnumber">2</span> <span class="toctext">Problem space addressed by Maildir</span></a></li>
<li class="toclevel-1"><a href="#Technical_operation"><span class="tocnumber">3</span> <span class="toctext">Technical operation</span></a></li>
<li class="toclevel-1"><a href="#Issues_with_lockless_operation"><span class="tocnumber">4</span> <span class="toctext">Issues with lockless operation</span></a></li>
<li class="toclevel-1"><a href="#Issues_noted_by_the_Dovecot_project"><span class="tocnumber">5</span> <span class="toctext">Issues noted by the Dovecot project</span></a></li>
<li class="toclevel-1"><a href="#Software_that_supports_Maildir_directly"><span class="tocnumber">6</span> <span class="toctext">Software that supports Maildir directly</span></a>
<ul>
<li class="toclevel-2"><a href="#Mail_servers"><span class="tocnumber">6.1</span> <span class="toctext">Mail servers</span></a></li>
<li class="toclevel-2"><a href="#Delivery_agents"><span class="tocnumber">6.2</span> <span class="toctext">Delivery agents</span></a></li>
<li class="toclevel-2"><a href="#Mail_readers"><span class="tocnumber">6.3</span> <span class="toctext">Mail readers</span></a></li>
<li class="toclevel-2"><a href="#Mail_index_and_search_tools"><span class="tocnumber">6.4</span> <span class="toctext">Mail index and search tools</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Software_that_supports_Maildir_by_implication"><span class="tocnumber">7</span> <span class="toctext">Software that supports Maildir by implication</span></a></li>
<li class="toclevel-1"><a href="#Windows_software"><span class="tocnumber">8</span> <span class="toctext">Windows software</span></a></li>
<li class="toclevel-1"><a href="#Notes_and_references"><span class="tocnumber">9</span> <span class="toctext">Notes and references</span></a></li>
<li class="toclevel-1"><a href="#See_also"><span class="tocnumber">10</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1"><a href="#External_links"><span class="tocnumber">11</span> <span class="toctext">External links</span></a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script>
<p><a name="Specifications" id="Specifications"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=1" title="Edit section: Specifications">edit</a>]</span> <span class="mw-headline">Specifications</span></h2>
<p>The Maildir concept is remarkable for being both simple and maintenance-free, despite being of vital functionality for large numbers of users.</p>
<p><a name="Maildir" id="Maildir"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=2" title="Edit section: Maildir">edit</a>]</span> <span class="mw-headline">Maildir</span></h3>
<p><a href="/wiki/Daniel_J._Bernstein" title="Daniel J. Bernstein">Daniel J. Bernstein</a>, the author of <a href="/wiki/Qmail" title="Qmail">qmail</a>, <a href="/wiki/Djbdns" title="Djbdns">djbdns</a>, and various other software wrote the original and only Maildir specification.<sup id="cite_ref-djbspec_0-0" class="reference"><a href="#cite_note-djbspec-0" title=""><span>[</span>1<span>]</span></a></sup> There have been no followups since by Bernstein and no effort to turn Maildir into a <a href="/wiki/Standardization" title="Standardization">standard</a>. The specification was written specifically for Bernstein's <a href="/wiki/Qmail" title="Qmail">qmail</a>, and is general enough to be implemented in many programs. Over time and many independent implementations, a small number of shortcomings have been discovered.</p>
<p><a name="Maildir.2B.2B" id="Maildir.2B.2B"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=3" title="Edit section: Maildir++">edit</a>]</span> <span class="mw-headline">Maildir++</span></h3>
<p>Sam Varshavchik, the author of the <a href="/wiki/Courier_Mail_Server" title="Courier Mail Server">Courier Mail Server</a> and other software, wrote an extension<sup id="cite_ref-plusplus_1-0" class="reference"><a href="#cite_note-plusplus-1" title=""><span>[</span>2<span>]</span></a></sup> to the Maildir format called <b>Maildir++</b> to support subfolders and mail quotas. Maildir++ directories contain subdirectories with names that start with a '.' (dot) that are also Maildir++ folders. This extension is therefore a violation of the Maildir specification, which provides an exhaustive list of the possible contents of a Maildir, however it is a compatible violation and other Maildir software supports Maildir++.</p>
<p><a name="Problem_space_addressed_by_Maildir" id="Problem_space_addressed_by_Maildir"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=4" title="Edit section: Problem space addressed by Maildir">edit</a>]</span> <span class="mw-headline">Problem space addressed by Maildir</span></h2>
<p>Mail needs to be stored in these circumstances:</p>
<ul>
<li>By an <a href="/wiki/SMTP" title="SMTP" class="mw-redirect">SMTP</a> <a href="/wiki/Mail_transfer_agent" title="Mail transfer agent">MTA</a>, after receiving from a remote mail server and while it is waiting to be delivered elsewhere. The storage area used by the MTA is often called a <a href="/wiki/Spooling" title="Spooling">spool</a>.</li>
<li>By an <a href="/wiki/IMAP" title="IMAP" class="mw-redirect">IMAP</a> <a href="/w/index.php?title=Mailstore&amp;action=edit&amp;redlink=1" class="new" title="Mailstore (page does not exist)">mailstore</a>, which serves email to mail client software (<a href="/wiki/Mail_user_agent" title="Mail user agent" class="mw-redirect">MUAs</a>).</li>
<li>In a local <a href="/wiki/User_(computing)" title="User (computing)">user account</a> where the user can read email using an MUA that reads the mail data directly rather than via a network protocol.</li>
<li>In other storage and processing situations, such as when filtering <a href="/wiki/Spam_(electronic)" title="Spam (electronic)">spam</a>.</li>
</ul>
<p>RFC822 and related standards define email messages to consist of lines of text, with strict rules concerning the first lines of text. This matches the idea of a file very well. Maildir, with its one file per message design, matches precisely what can be seen by watching SMTP email transiting a network by means of protocols such as SMTP. An MTA typically processes batches of email in a <a href="/wiki/Sequential_access" title="Sequential access">sequential access</a> manner, so again message-per-file is a good match.</p>
<p>A directory containing many files each containing one message is not sufficient on its own for a <a href="/w/index.php?title=Mailstore&amp;action=edit&amp;redlink=1" class="new" title="Mailstore (page does not exist)">mailstore</a> or other circumstance requiring <a href="/wiki/Random_access" title="Random access">random access</a> to email. Many implementors use a <a href="/wiki/Database" title="Database">database</a> because it is designed for indexing and searching. In 2007, filesystems usually give much better access times than databases,<sup class="noprint Template-Fact"><span title="This claim needs references to reliable sources&#160;since June 2008" style="white-space: nowrap;">[<i><a href="/wiki/Wikipedia:Citation_needed" title="Wikipedia:Citation needed">citation needed</a></i>]</span></sup> so the questions facing implementors come down to indexing methods and programming convenience versus speed, efficiency, reuse of existing technology and reliability. The <a href="/wiki/Cyrus_IMAP_server" title="Cyrus IMAP server">Cyrus IMAP server</a>, the <a href="/wiki/MH_Message_Handling_System" title="MH Message Handling System">MH Message Handling System</a>, the <a href="/wiki/Dovecot_(software)" title="Dovecot (software)">Dovecot</a> IMAP server and the <a href="/wiki/UW_IMAP" title="UW IMAP">UW IMAP</a> server all have private, mutually incompatible file-per-message storage formats with associated indexing schemes. (Dovecot and UW IMAP also implement formats that can be accessed by other software.)</p>
<p><a name="Technical_operation" id="Technical_operation"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=5" title="Edit section: Technical operation">edit</a>]</span> <span class="mw-headline">Technical operation</span></h2>
<p>The <a href="/wiki/Computer_process" title="Computer process" class="mw-redirect">process</a> that delivers an e-mail message writes it to a file in the <code>tmp</code> directory with a unique filename. The current algorithm for generating the unique filename combines the time, the host name, and a number of pseudo-random parameters to ensure uniqueness.<sup id="cite_ref-djbspec_0-1" class="reference"><a href="#cite_note-djbspec-0" title=""><span>[</span>1<span>]</span></a></sup></p>
<p>The delivery process stores the message in the maildir by creating and writing to <code>tmp/<i>unique</i></code>, and then moving this file to <code>new/<i>unique</i></code>. The moving is commonly done by hard linking the file to <code>new</code> and then unlinking the file from <code>tmp</code>, but some implementations simply <code>rename()</code> it there. This sequence guarantees that a maildir-reading program will not see a partially-written message, as MUAs never look in <code>tmp</code>.</p>
<p>When the <a href="/wiki/Mail_user_agent" title="Mail user agent" class="mw-redirect">mail user agent</a> process finds messages in the <code>new</code> directory it moves them to <code>cur</code> (using <code>rename()</code> - <i>link then unlink</i> strategy may result in having the message duplicated) and appends an informational suffix to the filename before reading them. The information suffix consists of a <a href="/wiki/Colon_(punctuation)" title="Colon (punctuation)">colon</a> (to separate the unique part of the filename from the actual information), a '2', a <a href="/wiki/Comma" title="Comma">comma</a> and various <a href="/wiki/Flag_(computing)" title="Flag (computing)">flags</a>. The '2' specifies, <a href="/wiki/Handwaving" title="Handwaving">loosely speaking</a>, the version of the information that follows the comma. '2' is the only currently officially specified version, '1' being an experimental version. One can only assume that it was used while the Maildir format was under development. The specification defines flags "P", "R", "S", "T", "D" and "F",<sup id="cite_ref-djbspec_0-2" class="reference"><a href="#cite_note-djbspec-0" title=""><span>[</span>1<span>]</span></a></sup>, while dovecot uses lowercase letters to match 26 IMAP keywords,<sup id="cite_ref-dovecot_2-0" class="reference"><a href="#cite_note-dovecot-2" title=""><span>[</span>3<span>]</span></a></sup> which may include standardised keywords such as $<a href="/wiki/Message_Disposition_Notification" title="Message Disposition Notification" class="mw-redirect">MDNSent</a>, and user defined flags.</p>
<p><a name="Issues_with_lockless_operation" id="Issues_with_lockless_operation"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=6" title="Edit section: Issues with lockless operation">edit</a>]</span> <span class="mw-headline">Issues with lockless operation</span></h2>
<p><a href="/wiki/Daniel_J._Bernstein" title="Daniel J. Bernstein">Daniel J. Bernstein</a> designed Maildir to be safely writable by multiple concurrent writers without any form of locking, even over NFS. To a large extent this works pretty well, but he did not take into account the real world limitations of today's filesystems. The problem is that after directory listing is started with the initial <code>readdir()</code> system call, any files that are renamed before the last <code>readdir()</code> call might not show up in the listing at all. This causes the listing process to believe that the message was deleted, while in reality only its flags were changed. When the process gets around to listing the messages again, the "deleted" message suddenly appears again. Some mail-accessing programs layer their own locking on top of Maildir in an attempt to prevent these kind of problems. <a href="/wiki/Dovecot_(software)" title="Dovecot (software)">Dovecot</a>, for example, uses its own non-standard locking with Maildir.</p>
<p><a href="/wiki/Mac_OS_X" title="Mac OS X">Mac OS X</a> with <a href="/wiki/HFS_Plus" title="HFS Plus">HFS Plus</a> (but not with <a href="/wiki/ZFS" title="ZFS">ZFS</a>) appears to avoid this problem for some reason. This issue can also be avoided with <a href="/wiki/Linux" title="Linux">Linux</a> by listening for changes in the Maildir with <a href="/wiki/Inotify" title="Inotify">inotify</a> and after readdiring see if inotify reported any new files.</p>
<p><a name="Issues_noted_by_the_Dovecot_project" id="Issues_noted_by_the_Dovecot_project"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=7" title="Edit section: Issues noted by the Dovecot project">edit</a>]</span> <span class="mw-headline">Issues noted by the Dovecot project</span></h2>
<p>The <a href="/wiki/Dovecot_(software)" title="Dovecot (software)">Dovecot</a> project, which implements an IMAP/POP3 server with built-in Maildir support has put forward some additional issues with the Maildir specification.<sup id="cite_ref-dovecot_2-1" class="reference"><a href="#cite_note-dovecot-2" title=""><span>[</span>3<span>]</span></a></sup> This critique portrays the Maildir delivery protocol as involving the following four steps (annotations from the Dovecot critique removed):</p>
<ol>
<li>Create a unique filename.</li>
<li>Do <code>stat(tmp/&lt;filename&gt;)</code>. If the <code>stat()</code> found a file, wait 2 seconds and go back to step 1.</li>
<li>Create and write the message to the <code>tmp/&lt;filename&gt;</code>.</li>
<li><code>link()</code> it into <code>new/</code> directory.</li>
</ol>
<p>The critique then states that:</p>
<blockquote>
<p>Only the first step is what really guarantees that the mails won't get overwritten, the rest just sounds nice. Even though they might catch a problem once in a while, they give no guaranteed protection ...</p>
</blockquote>
<p>for two technical reasons:</p>
<ol>
<li>Step 2 is pointless because there is a <a href="/wiki/Race_condition" title="Race condition">race condition</a> between steps 2 and 3. PID/host combination by itself should already guarantee that it never finds such a file.</li>
<li>In step 4 the <code>link()</code> will succeed at writing a file already delivered to the maildir, since a mail reader might have already moved the original copy to the <code>cur/</code> directory.</li>
</ol>
<p>This analysis misconstrues the purpose of step 2. There would indeed be a race condition if step 2 were intended to mitigate a situation where a badly behaved operating environment created concurrent processes with the same PID which could race against each other. The analysis is correct in asserting that step 1 constitutes the primary uniqueness guarantee <i>on a continuously operating host with a monotonic system clock</i>, a condition which it fails to note. In the situation where the maildir host is rebooted, it is not impossible that due to system clock recalibration or a misconfigured system clock that a unique filename that exists within the maildir from a previous uptime interval is generated again. Step 2 ensures that under this condition (rare on a stable mail system) a new mail item will not <a href="/wiki/Clobber_(computing)" title="Clobber (computing)" class="mw-redirect">clobber</a> an existing mail item existing in new/ directory (if it was already moved to <tt>cur/</tt> it is not caught, and if it only exists in <tt>tmp/</tt> it does not matter if it gets overwritten).</p>
<p>The criticism about <code>link()</code> possibly succeeding on a duplicated filename where the duplicate has already been moved to <tt>cur/</tt> has a certain validity. In the case of a non-monotonic system clock, it is possible for the Maildir delivery protocol, as specified by D.J. Bernstein, to inject the same filename more than once into (different areas) within a single Maildir directory tree. However, negative system clock skews are a rare event on a stable mail system, and the randomization of the PID further stacks the deck against this eventuality.</p>
<p>See the article on the <a href="/wiki/Network_Time_Protocol" title="Network Time Protocol">Network Time Protocol</a> for further information on system clock synchronization and issues which can lead to a misbehaved system clock.</p>
<p><a name="Software_that_supports_Maildir_directly" id="Software_that_supports_Maildir_directly"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=8" title="Edit section: Software that supports Maildir directly">edit</a>]</span> <span class="mw-headline">Software that supports Maildir directly</span></h2>
<p><a name="Mail_servers" id="Mail_servers"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=9" title="Edit section: Mail servers">edit</a>]</span> <span class="mw-headline">Mail servers</span></h3>
<ul>
<li><a href="/wiki/Dovecot_(software)" title="Dovecot (software)">Dovecot</a> IMAP server</li>
<li><a href="/wiki/Courier_Mail_Server" title="Courier Mail Server">Courier Mail Server</a> SMTP and IMAP server, for which the Maildir++ format was invented</li>
<li><a href="/wiki/Exim" title="Exim">Exim</a> SMTP server</li>
<li><a href="/wiki/Postfix_(software)" title="Postfix (software)">Postfix</a> SMTP server</li>
<li><a href="/wiki/Qmail" title="Qmail">Qmail</a> SMTP server, for which Maildir format was invented</li>
<li><a href="/wiki/XMail" title="XMail">XMail</a>, an <a href="/wiki/Open_source" title="Open source">open source</a> cross-platform (<a href="/wiki/*nix" title="*nix" class="mw-redirect">*nix</a> and <a href="/wiki/Microsoft_Windows" title="Microsoft Windows">Windows</a>) SMTP and POP3 server</li>
<li><a href="/wiki/MeTA1" title="MeTA1" class="mw-redirect">MeTA1</a> SMTP server</li>
</ul>
<p><a name="Delivery_agents" id="Delivery_agents"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=10" title="Edit section: Delivery agents">edit</a>]</span> <span class="mw-headline">Delivery agents</span></h3>
<ul>
<li><a href="/wiki/Procmail" title="Procmail">Procmail</a></li>
<li><a href="/wiki/Maildrop" title="Maildrop">Maildrop</a></li>
<li><a href="/wiki/Getmail" title="Getmail">Getmail</a>, a Maildir-aware mail-retrieval and delivery agent alternative to <a href="/wiki/Fetchmail" title="Fetchmail">Fetchmail</a></li>
<li><a href="/w/index.php?title=OfflineIMAP&amp;action=edit&amp;redlink=1" class="new" title="OfflineIMAP (page does not exist)">OfflineIMAP</a>, a program which keeps a local Maildir intelligently synchronised with an account on an IMAP server</li>
</ul>
<p><a name="Mail_readers" id="Mail_readers"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=11" title="Edit section: Mail readers">edit</a>]</span> <span class="mw-headline">Mail readers</span></h3>
<ul>
<li><a href="/wiki/Balsa_(e-mail_client)" title="Balsa (e-mail client)">Balsa</a> previously the official GNOME mail reader (prior to Novell Evolution)</li>
<li><a href="/wiki/Claws_Mail" title="Claws Mail">Claws Mail</a> through a <a href="http://www.claws-mail.org/plugins.php" class="external text" title="http://www.claws-mail.org/plugins.php" rel="nofollow">plugin</a></li>
<li><a href="/wiki/Cone_(software)" title="Cone (software)">Cone</a> a curses-based mail reader</li>
<li><a href="/wiki/Gnus" title="Gnus">Gnus</a></li>
<li><a href="/wiki/Mailx" title="Mailx">mailx</a></li>
<li><a href="/wiki/GNUMail" title="GNUMail">GNUMail</a></li>
<li><a href="/wiki/KMail" title="KMail" class="mw-redirect">KMail</a> a KDE mail reader</li>
<li><a href="/wiki/Mutt_(e-mail_client)" title="Mutt (e-mail client)">Mutt</a></li>
<li><a href="/wiki/Novell_Evolution" title="Novell Evolution" class="mw-redirect">Novell Evolution</a> official GNOME mail client resembling Outlook</li>
<li><a href="/wiki/Wanderlust_(software)" title="Wanderlust (software)">Wanderlust (software)</a></li>
</ul>
<p><a name="Mail_index_and_search_tools" id="Mail_index_and_search_tools"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=12" title="Edit section: Mail index and search tools">edit</a>]</span> <span class="mw-headline">Mail index and search tools</span></h3>
<ul>
<li><a href="/wiki/Beagle_(software)" title="Beagle (software)">Beagle (software)</a> can index Maildirs and many other information storage formats</li>
</ul>
<p><a name="Software_that_supports_Maildir_by_implication" id="Software_that_supports_Maildir_by_implication"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=13" title="Edit section: Software that supports Maildir by implication">edit</a>]</span> <span class="mw-headline">Software that supports Maildir by implication</span></h2>
<p>The list of software that can be used with Maildir is in fact much larger if you consider how this software can be plugged together, and the role of network access protocols.</p>
<p>For example:</p>
<ul>
<li>The <a href="/wiki/Sendmail" title="Sendmail">Sendmail</a> MTA does not support any mail delivery format (although many assume that it does). Sendmail uses a separate delivery process called <code>mail.local</code>. Procmail (and other programs that support Maildir) can be used in place of <code>mail.local</code>, so Sendmail can rightly be said to support Maildir as much as it supports any other format.</li>
<li>Many mail readers do not support Maildir but do support remote access formats such as IMAP. Since there are several IMAP mail stores that support Maildir, any mail reader that supports IMAP such as <a href="/wiki/Microsoft_Outlook" title="Microsoft Outlook">Microsoft Outlook</a>, <a href="/wiki/Pine_(e-mail_client)" title="Pine (e-mail client)">Pine</a>, or <a href="/wiki/Mozilla_Thunderbird" title="Mozilla Thunderbird">Mozilla Thunderbird</a> can be used to access Maildir folders.</li>
<li><a href="/wiki/Fetchmail" title="Fetchmail">Fetchmail</a> does not support Maildir (or any local delivery format) but since it talks to an SMTP server or local delivery agent, any of those listed above can be used to deliver mail from Fetchmail to Maildirs.</li>
</ul>
<p><a name="Windows_software" id="Windows_software"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=14" title="Edit section: Windows software">edit</a>]</span> <span class="mw-headline">Windows software</span></h2>
<p>The Maildir standard cannot be implemented without modification on systems running <a href="/wiki/Microsoft_Windows" title="Microsoft Windows">Microsoft Windows</a>, which does not tolerate colons in filenames. There is no technical reason why software on Windows cannot use an alternative (such as ";", or "-") however lacking any way of updating the specification there has been no agreement on what character this should be. One Windows program may write Maildir files that are unreadable to another Windows program. There are programs that support Maildir written in languages such as <a href="/wiki/Python_(programming_language)" title="Python (programming language)">Python</a> and <a href="/wiki/Perl" title="Perl">Perl</a>, or which have been ported from Unix using <a href="/wiki/Cygwin" title="Cygwin">Cygwin</a> or other systems that could function reliably together if this issue were addressed.</p>
<p><a name="Notes_and_references" id="Notes_and_references"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=15" title="Edit section: Notes and references">edit</a>]</span> <span class="mw-headline">Notes and references</span></h2>
<div class="references-small">
<ol class="references">
<li id="cite_note-djbspec-0">^ <a href="#cite_ref-djbspec_0-0" title=""><sup><i><b>a</b></i></sup></a> <a href="#cite_ref-djbspec_0-1" title=""><sup><i><b>b</b></i></sup></a> <a href="#cite_ref-djbspec_0-2" title=""><sup><i><b>c</b></i></sup></a> Daniel J. Bernstein. (1995) <a href="http://cr.yp.to/proto/maildir.html" class="external text" title="http://cr.yp.to/proto/maildir.html" rel="nofollow">Using maildir format</a></li>
<li id="cite_note-plusplus-1"><b><a href="#cite_ref-plusplus_1-0" title="">^</a></b> Varshavchik, Sam (1998) <a href="http://www.inter7.com/courierimap/README.maildirquota.html" class="external text" title="http://www.inter7.com/courierimap/README.maildirquota.html" rel="nofollow">Maildir++ and Maildir quotas</a> which has the Maildir++ specification buried within it</li>
<li id="cite_note-dovecot-2">^ <a href="#cite_ref-dovecot_2-0" title=""><sup><i><b>a</b></i></sup></a> <a href="#cite_ref-dovecot_2-1" title=""><sup><i><b>b</b></i></sup></a> <a href="http://wiki.dovecot.org/MailboxFormat/Maildir" class="external text" title="http://wiki.dovecot.org/MailboxFormat/Maildir" rel="nofollow">Dovecot Wiki: maildir format</a></li>
</ol>
</div>
<p><a name="See_also" id="See_also"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=16" title="Edit section: See also">edit</a>]</span> <span class="mw-headline">See also</span></h2>
<ul>
<li><a href="/wiki/Mbox" title="Mbox">mbox</a></li>
<li><a href="/wiki/MH_Message_Handling_System" title="MH Message Handling System">MH Message Handling System</a></li>
<li><a href="/wiki/MIX_(Email)" title="MIX (Email)">MIX (Email)</a></li>
</ul>
<p><a name="External_links" id="External_links"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Maildir&amp;action=edit&amp;section=17" title="Edit section: External links">edit</a>]</span> <span class="mw-headline">External links</span></h2>
<ul>
<li><a href="http://www.qmail.org/qmail-manual-html/man5/maildir.html" class="external text" title="http://www.qmail.org/qmail-manual-html/man5/maildir.html" rel="nofollow">manual page for maildir</a></li>
<li><a href="http://www.maildir.net" class="external text" title="http://www.maildir.net" rel="nofollow">maildir e-mail directory service</a></li>
</ul>


<!-- 
NewPP limit report
Preprocessor node count: 411/1000000
Post-expand include size: 7395/2048000 bytes
Template argument size: 2734/2048000 bytes
Expensive parser function count: 3/500
-->

<!-- Saved in parser cache with key enwiki:pcache:idhash:60067-0!1!0!default!!en!2 and timestamp 20090405083624 -->
<div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org/wiki/Maildir">http://en.wikipedia.org/wiki/Maildir</a>"</div>
			<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Categories</a>:&#32;<span dir='ltr'><a href="/wiki/Category:E-mail_storage_formats" title="Category:E-mail storage formats">E-mail storage formats</a></span></div><div id="mw-hidden-catlinks" class="mw-hidden-cats-hidden">Hidden categories:&#32;<span dir='ltr'><a href="/wiki/Category:Articles_lacking_reliable_references_from_April_2009" title="Category:Articles lacking reliable references from April 2009">Articles lacking reliable references from April 2009</a></span> | <span dir='ltr'><a href="/wiki/Category:All_articles_lacking_sources" title="Category:All articles lacking sources">All articles lacking sources</a></span> | <span dir='ltr'><a href="/wiki/Category:Articles_needing_additional_references_from_April_2009" title="Category:Articles needing additional references from April 2009">Articles needing additional references from April 2009</a></span> | <span dir='ltr'><a href="/wiki/Category:All_articles_with_unsourced_statements" title="Category:All articles with unsourced statements">All articles with unsourced statements</a></span> | <span dir='ltr'><a href="/wiki/Category:Articles_with_unsourced_statements_since_June_2008" title="Category:Articles with unsourced statements since June 2008">Articles with unsourced statements since June 2008</a></span></div></div>			<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="/wiki/Maildir" title="View the content page [c]" accesskey="c">Article</a></li>
				 <li id="ca-talk"><a href="/wiki/Talk:Maildir" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-edit"><a href="/w/index.php?title=Maildir&amp;action=edit" title="You can edit this page. &#10;Please use the preview button before saving. [e]" accesskey="e">Edit this page</a></li>
				 <li id="ca-history"><a href="/w/index.php?title=Maildir&amp;action=history" title="Past versions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Maildir" title="You are encouraged to log in; however, it is not mandatory. [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://upload.wikimedia.org/wikipedia/en/b/bc/Wiki.png);" href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-contents"><a href="/wiki/Portal:Contents" title="Guides to browsing Wikipedia">Contents</a></li>
				<li id="n-featuredcontent"><a href="/wiki/Portal:Featured_content" title="Featured content — the best of Wikipedia">Featured content</a></li>
				<li id="n-currentevents"><a href="/wiki/Portal:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random article [x]" accesskey="x">Random article</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/w/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search Wikipedia [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if one exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search Wikipedia for this text" />
			</div></form>
		</div>
	</div>
	<div class='generated-sidebar portlet' id='p-interaction'>
		<h5>Interaction</h5>
		<div class='pBody'>
			<ul>
				<li id="n-aboutsite"><a href="/wiki/Wikipedia:About" title="Find out about Wikipedia">About Wikipedia</a></li>
				<li id="n-portal"><a href="/wiki/Wikipedia:Community_portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-contact"><a href="/wiki/Wikipedia:Contact_us" title="How to contact Wikipedia">Contact Wikipedia</a></li>
				<li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Donate" title="Support us">Donate to Wikipedia</a></li>
				<li id="n-help"><a href="/wiki/Help:Contents" title="Guidance on how to use and edit Wikipedia">Help</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/Maildir" title="List of all English Wikipedia pages containing links to this page [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/Maildir" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-upload"><a href="/wiki/Wikipedia:Upload" title="Upload files [u]" accesskey="u">Upload file</a></li>
<li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/w/index.php?title=Maildir&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="/w/index.php?title=Maildir&amp;oldid=281862247" title="Permanent link to this version of the page">Permanent link</a></li><li id="t-cite"><a href="/w/index.php?title=Special:Cite&amp;page=Maildir&amp;id=281862247">Cite this page</a></li>			</ul>
		</div>
	</div>
	<div id="p-lang" class="portlet">
		<h5>Languages</h5>
		<div class="pBody">
			<ul>
				<li class="interwiki-de"><a href="http://de.wikipedia.org/wiki/Maildir">Deutsch</a></li>
				<li class="interwiki-es"><a href="http://es.wikipedia.org/wiki/Maildir">Español</a></li>
				<li class="interwiki-fr"><a href="http://fr.wikipedia.org/wiki/Maildir">Français</a></li>
				<li class="interwiki-nl"><a href="http://nl.wikipedia.org/wiki/Maildir">Nederlands</a></li>
				<li class="interwiki-pl"><a href="http://pl.wikipedia.org/wiki/Maildir">Polski</a></li>
				<li class="interwiki-ru"><a href="http://ru.wikipedia.org/wiki/Maildir">Русский</a></li>
				<li class="interwiki-sv"><a href="http://sv.wikipedia.org/wiki/Maildir">Svenska</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/skins-1.5/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
				<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="/images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 5 April 2009, at 08:36.</li>
					<li id="copyright">All text is available under the terms of the <a class='internal' href="http://en.wikipedia.org/wiki/Wikipedia:Text_of_the_GNU_Free_Documentation_License" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="http://en.wikipedia.org/wiki/Wikipedia:Copyrights" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc.</a>, a U.S. registered <a class='internal' href="http://en.wikipedia.org/wiki/501%28c%29#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="http://en.wikipedia.org/wiki/Non-profit_organization" title="Non-profit organization">nonprofit</a> <a href="http://en.wikipedia.org/wiki/Charitable_organization" title="Charitable organization">charity</a>.<br /></li>
					<li id="privacy"><a href="http://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="/wiki/Wikipedia:About" title="Wikipedia:About">About Wikipedia</a></li>
					<li id="disclaimer"><a href="/wiki/Wikipedia:General_disclaimer" title="Wikipedia:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served by srv205 in 0.167 secs. --></body></html>
