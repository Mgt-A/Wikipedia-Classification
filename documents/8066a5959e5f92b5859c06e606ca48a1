<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15alpha" />
		<meta name="keywords" content="Session fixation,AOL,Alice and Bob,Browser exploit,Cross-calation,Cross-site cooking,Cross-site request forgery,Defense in depth,Exploit (computer security),HTTPS,HTTP cookie" />
		<link rel="alternate" type="application/x-wiki" title="Edit this page" href="/w/index.php?title=Session_fixation&amp;action=edit" />
		<link rel="edit" title="Edit this page" href="/w/index.php?title=Session_fixation&amp;action=edit" />
		<link rel="apple-touch-icon" href="http://en.wikipedia.org/apple-touch-icon.png" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Wikipedia (en)" />
		<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html" />
		<link rel="alternate" type="application/rss+xml" title="Wikipedia RSS Feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="Wikipedia Atom Feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>Session fixation - Wikipedia, the free encyclopedia</title>
		<link rel="stylesheet" href="/skins-1.5/common/shared.css?207xx" type="text/css" media="screen" />
		<link rel="stylesheet" href="/skins-1.5/common/commonPrint.css?207xx" type="text/css" media="print" />
		<link rel="stylesheet" href="/skins-1.5/monobook/main.css?207xx" type="text/css" media="screen" />
		<link rel="stylesheet" href="/skins-1.5/chick/main.css?207xx" type="text/css" media="handheld" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins-1.5/monobook/IE50Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/skins-1.5/monobook/IE55Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/skins-1.5/monobook/IE60Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/skins-1.5/monobook/IE70Fixes.css?207xx" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" />
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" media="print" />
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Handheld.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" media="handheld" />
		<link rel="stylesheet" href="/w/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=2678400&amp;action=raw&amp;maxage=2678400" type="text/css" />
		<link rel="stylesheet" href="/w/index.php?title=-&amp;action=raw&amp;maxage=2678400&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="/skins-1.5/common/IEFixes.js?207xx"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/skins-1.5";
		var wgArticlePath = "/wiki/$1";
		var wgScriptPath = "/w";
		var wgScript = "/w/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://en.wikipedia.org";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Session_fixation";
		var wgTitle = "Session fixation";
		var wgAction = "view";
		var wgArticleId = "3764708";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 286037851;
		var wgVersion = "1.15alpha";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgMWSuggestTemplate = "http://en.wikipedia.org/w/api.php?action=opensearch\x26search={searchTerms}\x26namespace={namespaces}\x26suggest";
		var wgDBname = "enwiki";
		var wgSearchNamespaces = [0];
		var wgMWSuggestMessages = ["with suggestions", "no suggestions"];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="/skins-1.5/common/wikibits.js?207xx"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="/skins-1.5/common/ajax.js?207xx"></script>
		<script type="text/javascript" src="/skins-1.5/common/mwsuggest.js?207xx"></script>
<script type="text/javascript">/*<![CDATA[*/
var wgNotice='';var wgNoticeLocal='';
/*]]>*/</script>		<script type="text/javascript" src="http://upload.wikimedia.org/centralnotice/wikipedia/en/centralnotice.js?207xx"></script>
		<script type="text/javascript" src="/w/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Session_fixation skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
		<div id="siteNotice"><script type='text/javascript'>if (wgNotice != '') document.writeln(wgNotice);</script></div>		<h1 id="firstHeading" class="firstHeading">Session fixation</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From Wikipedia, the free encyclopedia</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p>In computer network security, <b>session fixation attacks</b> attempt to <a href="/wiki/Exploit_(computer_security)" title="Exploit (computer security)">exploit</a> the vulnerability of a system which allows one person to fixate (set) another person's <a href="/wiki/Session_(computer_science)" title="Session (computer science)">session</a> identifier (SID). Most session fixation attacks are web based, and most rely on session identifiers being accepted from <a href="/wiki/Uniform_Resource_Locator" title="Uniform Resource Locator">URLs</a> (<a href="/wiki/Query_string" title="Query string">query string</a>) or POST data.</p>
<table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="#Attack_scenarios"><span class="tocnumber">1</span> <span class="toctext">Attack scenarios</span></a>
<ul>
<li class="toclevel-2"><a href="#A_simple_attack_scenario"><span class="tocnumber">1.1</span> <span class="toctext">A simple attack scenario</span></a></li>
<li class="toclevel-2"><a href="#Attack_using_server_generated_SID"><span class="tocnumber">1.2</span> <span class="toctext">Attack using server generated SID</span></a></li>
<li class="toclevel-2"><a href="#Attacks_using_cross-site_cooking"><span class="tocnumber">1.3</span> <span class="toctext">Attacks using cross-site cooking</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Countermeasures"><span class="tocnumber">2</span> <span class="toctext">Countermeasures</span></a>
<ul>
<li class="toclevel-2"><a href="#Do_not_accept_session_identifiers_from_GET_.2F_POST_variables"><span class="tocnumber">2.1</span> <span class="toctext">Do not accept session identifiers from GET / POST variables</span></a>
<ul>
<li class="toclevel-3"><a href="#Solution:_Store_session_identifiers_in_HTTP_cookies"><span class="tocnumber">2.1.1</span> <span class="toctext">Solution: Store session identifiers in HTTP cookies</span></a></li>
<li class="toclevel-3"><a href="#Solution:_Utilize_SSL_.2F_TLS_Session_identifier"><span class="tocnumber">2.1.2</span> <span class="toctext">Solution: Utilize SSL / TLS Session identifier</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Regenerate_SID_on_each_request"><span class="tocnumber">2.2</span> <span class="toctext">Regenerate SID on each request</span></a></li>
<li class="toclevel-2"><a href="#Accept_only_server_generated_SIDs"><span class="tocnumber">2.3</span> <span class="toctext">Accept only server generated SIDs</span></a></li>
<li class="toclevel-2"><a href="#Logout_function"><span class="tocnumber">2.4</span> <span class="toctext">Logout function</span></a></li>
<li class="toclevel-2"><a href="#Time-out_old_SIDs"><span class="tocnumber">2.5</span> <span class="toctext">Time-out old SIDs</span></a></li>
<li class="toclevel-2"><a href="#Destroy_session_if_Referrer_is_suspicious"><span class="tocnumber">2.6</span> <span class="toctext">Destroy session if Referrer is suspicious</span></a></li>
<li class="toclevel-2"><a href="#Verify_that_additional_information_is_consistent_throughout_session"><span class="tocnumber">2.7</span> <span class="toctext">Verify that additional information is consistent throughout session</span></a>
<ul>
<li class="toclevel-3"><a href="#User_Agent"><span class="tocnumber">2.7.1</span> <span class="toctext">User Agent</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Defense_in_Depth"><span class="tocnumber">3</span> <span class="toctext">Defense in Depth</span></a></li>
<li class="toclevel-1"><a href="#See_also"><span class="tocnumber">4</span> <span class="toctext">See also</span></a></li>
<li class="toclevel-1"><a href="#External_links"><span class="tocnumber">5</span> <span class="toctext">External links</span></a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script>
<p><a name="Attack_scenarios" id="Attack_scenarios"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=1" title="Edit section: Attack scenarios">edit</a>]</span> <span class="mw-headline">Attack scenarios</span></h2>
<p><a href="/wiki/Alice_and_Bob" title="Alice and Bob" class="mw-redirect">Alice</a> has an account at the bank <code>http://unsafe/</code>. Unfortunately, Alice is not very security savvy.</p>
<p><a href="/wiki/Alice_and_Bob" title="Alice and Bob" class="mw-redirect">Mallory</a> is out to get Alice's money from the bank.</p>
<p>Alice has a reasonable level of trust in Mallory, and will visit links Mallory sends her.</p>
<p><a name="A_simple_attack_scenario" id="A_simple_attack_scenario"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=2" title="Edit section: A simple attack scenario">edit</a>]</span> <span class="mw-headline">A simple attack scenario</span></h3>
<p>Straightforward scenario:</p>
<ol>
<li>Mallory has determined that <code>http://unsafe/</code> accepts any session identifier, accepts session identifiers from query strings and has no security validation. <code>http://unsafe/</code> is thus not secure.</li>
<li>Mallory sends Alice an e-mail: "Hey, check this out, there is a cool new account summary feature on our bank, <code>http://unsafe/?SID=I_WILL_KNOW_THE_SID</code>". Mallory is trying to fixate the SID to <code>I_WILL_KNOW_THE_SID</code>.</li>
<li>Alice is interested and visits <code>http://unsafe/?SID=I_WILL_KNOW_THE_SID</code>. The usual log-on screen pops up, and Alice logs on.</li>
<li>Mallory visits <code>http://unsafe/?SID=I_WILL_KNOW_THE_SID</code> and now has unlimited access to Alice's account.</li>
</ol>
<p><a name="Attack_using_server_generated_SID" id="Attack_using_server_generated_SID"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=3" title="Edit section: Attack using server generated SID">edit</a>]</span> <span class="mw-headline">Attack using server generated SID</span></h3>
<p>A misconception is that servers which only accept server generated session identifiers are safe from fixation. This is <b>false</b>.</p>
<p>Scenario:</p>
<ol>
<li>Mallory visits <code>http://vulnerable/</code> and checks which SID is returned. For example, the server may respond: <code>Set-Cookie: SID=0D6441FEA4496C2</code>.</li>
<li>Mallory is now able to send Alice an e-mail: "Check out this new cool feature on our bank, <code>http://vulnerable/?SID=0D6441FEA4496C2</code>."</li>
<li>Alice logs on, with fixated session identifier <code>SID=0D6441FEA4496C2</code>.</li>
</ol>
<p><a name="Attacks_using_cross-site_cooking" id="Attacks_using_cross-site_cooking"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=4" title="Edit section: Attacks using cross-site cooking">edit</a>]</span> <span class="mw-headline">Attacks using cross-site cooking</span></h3>
<p>Another session fixation attack, <a href="/wiki/Cross-site_cooking" title="Cross-site cooking">cross-site cooking</a>, exploits <a href="/wiki/Browser_exploit" title="Browser exploit">browser vulnerabilities</a>. This allows the site <code>http://evil/</code> to store cookies in Alice's browser in the cookie domain of another server <code>http://good/</code>, which is trusted. This attack can succeed even when there is no vulnerability within <code>http://good/</code>, because <code>http://good/</code> may assume that browser cookie management is secure.</p>
<p>Scenario:</p>
<ol>
<li>Mallory sends Alice an e-mail: "Hey, check out this cool site, <code>http://evil/</code>".</li>
<li>Alice visits <code>http://evil/</code>, which sets the cookie <code>SID</code> with the value <code>I_WILL_KNOW_THE_SID</code> into the domain of <code>http://good/</code>.</li>
<li>Alice then receives an e-mail from Mallory, "Hey, check out your bank account at <code>http://good/</code>".</li>
<li>Once Alice logs on, Mallory can use her account using the fixated session identifier.</li>
</ol>
<p>Each of these attack scenarios has resulted in <a href="/wiki/Cross-calation" title="Cross-calation" class="mw-redirect">Cross-calation</a>, where Mallory has successfully gained access to the functions and data normally reserved for Alice.</p>
<p><a name="Countermeasures" id="Countermeasures"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=5" title="Edit section: Countermeasures">edit</a>]</span> <span class="mw-headline">Countermeasures</span></h2>
<p><a name="Do_not_accept_session_identifiers_from_GET_.2F_POST_variables" id="Do_not_accept_session_identifiers_from_GET_.2F_POST_variables"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=6" title="Edit section: Do not accept session identifiers from GET / POST variables">edit</a>]</span> <span class="mw-headline">Do not accept session identifiers from GET / POST variables</span></h3>
<p>Session identifiers in URL (query string, GET variables) or POST variables are not recommended as they simplify this attack – it is easy to make links or forms which set GET / POST variables.</p>
<p>Additionally, session identifiers (SIDs) in query strings enable other risk and attack scenarios;</p>
<ul>
<li>The SID is leaked to others servers through the <a href="/wiki/Referrer" title="Referrer" class="mw-redirect">Referrer</a></li>
<li>The SID is leaked to other people as users cut &amp; paste "interesting links" from the address bar into chat, forums, communities, etc.</li>
<li>The SID is stored in many places (browser history log, web server log, proxy logs, ...)</li>
</ul>
<p><a name="Solution:_Store_session_identifiers_in_HTTP_cookies" id="Solution:_Store_session_identifiers_in_HTTP_cookies"></a></p>
<h4><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=7" title="Edit section: Solution: Store session identifiers in HTTP cookies">edit</a>]</span> <span class="mw-headline">Solution: Store session identifiers in HTTP cookies</span></h4>
<p>The session identifier on most modern systems is stored by default in an <a href="/wiki/HTTP_cookie" title="HTTP cookie">HTTP cookie</a>, which has a moderate level of security.</p>
<p>However, modern systems often accept session identifiers from GET/POST as well. The web server configuration must be modified to protect against this vulnerability.</p>
<p>For PHP, you need to have access to the configuration file to use this: <i>php.ini</i>:</p>
<pre>
; Whether to use cookies.
session.use_cookies = 1

; This option enables administrators to make their users invulnerable to
; attacks which involve passing session ids in URLs; defaults to 0.
session.use_only_cookies = 1
</pre>
<p><a name="Solution:_Utilize_SSL_.2F_TLS_Session_identifier" id="Solution:_Utilize_SSL_.2F_TLS_Session_identifier"></a></p>
<h4><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=8" title="Edit section: Solution: Utilize SSL / TLS Session identifier">edit</a>]</span> <span class="mw-headline">Solution: Utilize SSL / TLS Session identifier</span></h4>
<p>When enabling <a href="/wiki/HTTPS" title="HTTPS" class="mw-redirect">HTTPS</a> security, some systems allow applications to obtain the <a href="/wiki/Transport_Layer_Security" title="Transport Layer Security">SSL / TLS</a> session identifier. Use of the SSL/TLS session identifier is very secure, but many web development languages do not provide robust built-in functionality for this.</p>
<p>SSL/TLS session identifiers may be suitable only for critical applications, such as those on large financial sites, due to the size of the systems. This issue, however, is rarely debated even in security forums.</p>
<p><a name="Regenerate_SID_on_each_request" id="Regenerate_SID_on_each_request"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=9" title="Edit section: Regenerate SID on each request">edit</a>]</span> <span class="mw-headline">Regenerate SID on each request</span></h3>
<p>A countermeasure against session fixation is to generate a new session identifier (SID) on each request. If this is done, then even though an attacker may trick a user into accepting a known SID, the SID will be invalid when the attacker attempts to re-use the SID. Implementation of such a system is simple, as demonstrated by the following:</p>
<ul>
<li>Get previous Session Identifier <code>OLD_SID</code> from HTTP request.</li>
<li>If <code>OLD_SID</code> is null, empty, or no session with SID=<code>OLD_SID</code> exists, create a new session.</li>
<li>Generate new session identifier <code>NEW_SID</code> with a secure random number generator.</li>
<li>Let session be identified by SID=<code>NEW_SID</code> (and no longer by SID=<code>OLD_SID</code>)</li>
<li>Transmit new SID to client.</li>
</ul>
<p>Example:</p>
<p>If Mallory successfully tricks Alice into visiting <code>http://victim/?SID=I_KNOW_THE_SID</code>, this HTTP request is sent to <code>victim</code>:</p>
<pre>
GET /?SID=I_KNOW_THE_SID HTTP/1.1
Host: victim
</pre>
<p><code>victim</code> accepts <code>SID=I_KNOW_THE_SID</code>, which is bad. However, <code>victim</code> is secure because it performs session regeneration. <code>victim</code> gets the following response:</p>
<pre>
HTTP/1.1 200 OK
Set-Cookie: SID=3134998145AB331F
</pre>
<p>Alice will now use <code>SID=3134998145AB331F</code> which is unknown to Mallory, and <code>SID=I_KNOW_THE_SID</code> is invalid. Mallory is thus unsuccessful in the session fixation attempt.</p>
<p>Unfortunately session regeneration is not always possible. Problems are known to occur when third-party software such as ActiveX or Java Applets is used, and when browser plugins communicate with the server. Third-party software could cause logouts, or the session could be split into two separate sessions.</p>
<p><a name="Accept_only_server_generated_SIDs" id="Accept_only_server_generated_SIDs"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=10" title="Edit section: Accept only server generated SIDs">edit</a>]</span> <span class="mw-headline">Accept only server generated SIDs</span></h3>
<p>One way to improve security is not to accept session identifiers that were not generated by the server.</p>
<pre>
if (!isset($_SESSION['SERVER_GENERATED_SID'])) {
   session_destroy(); // destroy all data in session
}
session_regenerate_id(); // generate a new session identifier
$_SESSION['SERVER_GENERATED_SID'] = true;
</pre>
<p><a name="Logout_function" id="Logout_function"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=11" title="Edit section: Logout function">edit</a>]</span> <span class="mw-headline">Logout function</span></h3>
<p>A logout function is useful as it allows users to indicate that a session should not allow further requests. Thus attacks can only be effective while a session is active. Note that the following code performs no <a href="/wiki/Cross-site_request_forgery" title="Cross-site request forgery">Cross-site request forgery</a> checks, potentially allowing an attacker to force users to log out of the web application.</p>
<pre>
if (isset($_GET['LOGOUT']))
   session_destroy(); // destroy all data in session
</pre>
<p><a name="Time-out_old_SIDs" id="Time-out_old_SIDs"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=12" title="Edit section: Time-out old SIDs">edit</a>]</span> <span class="mw-headline">Time-out old SIDs</span></h3>
<p>This defense is simple to implement and has the advantage of providing a measure of protection against unauthorized users accessing an authorized user's account by using a machine that may have been left unattended.</p>
<p>Store a session variable containing a time stamp of the last access made by that SID. When that SID is used again, compare the current timestamp (in PHP you can get this by using the time() function call) with the one stored in the session. If the difference is greater than a predefined number, say 5 minutes, destroy the session. Otherwise, update the session variable with the current timestamp.</p>
<p><a name="Destroy_session_if_Referrer_is_suspicious" id="Destroy_session_if_Referrer_is_suspicious"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=13" title="Edit section: Destroy session if Referrer is suspicious">edit</a>]</span> <span class="mw-headline">Destroy session if Referrer is suspicious</span></h3>
<p>When visiting a page, most browsers will set the <a href="/wiki/Referrer" title="Referrer" class="mw-redirect">Referrer</a> – the page that contained the link that you followed to get to this page.</p>
<p>When the user is logged into a site that is not likely to be linked to from outside that site (e.g., banking websites, or <a href="/wiki/Webmail" title="Webmail">webmail</a>), and the site is not the kind of site where users would remain logged in for any great length of time, the Referrer should be from that site. Any other Referrer should be considered suspicious.</p>
<p>For example, <code>http://vulnerable/</code> could employ the following security check:</p>
<pre>
if (strpos($_SERVER['HTTP_REFERER'], 'http://vulnerable/') !== 0) {
   session_destroy(); // destroy all data in session
}
session_regenerate_id(); // generate a new session identifier
</pre>
<p><a name="Verify_that_additional_information_is_consistent_throughout_session" id="Verify_that_additional_information_is_consistent_throughout_session"></a></p>
<h3><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=14" title="Edit section: Verify that additional information is consistent throughout session">edit</a>]</span> <span class="mw-headline">Verify that additional information is consistent throughout session</span></h3>
<p>One way to further improve security is to ensure that the user appears to be the same end user (client). This makes it a bit harder to perform session fixation and other attacks.</p>
<p>As more and more networks begin to conform to <a href="http://tools.ietf.org/html/rfc3704" class="external" title="http://tools.ietf.org/html/rfc3704">RFC 3704</a> and other anti-<a href="/wiki/Spoofing_attack" title="Spoofing attack">spoofing</a> practices, the IP address becomes more reliable as a "same source" identifier. Therefore, the security of a web site can be improved by verifying that the source IP is consistent throughout a session.</p>
<p>This could be performed in this manner:</p>
<pre>
if($_SERVER['REMOTE_ADDR'] != $_SESSION['PREV_REMOTEADDR']) {
   session_destroy(); // destroy all data in session
}
session_regenerate_id(); // generate a new session identifier
$_SESSION['PREV_REMOTEADDR'] = $_SERVER['REMOTE_ADDR'];
</pre>
<p>However, there are some points to consider before employing this approach.</p>
<ul>
<li>Several users may share one IP. It is not uncommon for an entire building to share one IP using <a href="/wiki/Network_address_translation" title="Network address translation">NAT</a>.</li>
<li>One user may have an inconsistent IP. This is true for users behind proxies (such as <a href="/wiki/AOL" title="AOL">AOL</a> customers). It is also true for some mobile/roaming users.</li>
</ul>
<p>For some sites, the added security outweighs the lack of convenience, and for others it does not.</p>
<p><a name="User_Agent" id="User_Agent"></a></p>
<h4><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=15" title="Edit section: User Agent">edit</a>]</span> <span class="mw-headline">User Agent</span></h4>
<p>Browsers identify themselves by "User-Agent" HTTP headers. This header does not normally change during use; it would be extremely suspicious if that were to happen. A web application might make use of User-Agent detection in attempt to prevent malicious users from stealing sessions.</p>
<pre>
if ($_SERVER['HTTP_USER_AGENT'] !== $_SESSION['PREV_USERAGENT']) {
   session_destroy(); // destroy all data in session
}
session_regenerate_id(); // generate a new session identifier
$_SESSION['PREV_USERAGENT'] = $_SERVER['HTTP_USER_AGENT'];
</pre>
<p><a name="Defense_in_Depth" id="Defense_in_Depth"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=16" title="Edit section: Defense in Depth">edit</a>]</span> <span class="mw-headline">Defense in Depth</span></h2>
<p><a href="/wiki/Defense_in_depth" title="Defense in depth" class="mw-redirect">Defense in depth</a> is to combine several countermeasures. The idea is simple: if one obstacle is hard to overcome, several obstacles could be very hard to overcome.</p>
<p>A Defence in Depth strategy could involve:</p>
<ul>
<li>Enable HTTPS (to protect against other problems)</li>
<li>Correct configuration (do not accept external SIDs, set time-out, etc.)</li>
<li>Perform session_regeneration, support log-out, reject illegal referrers, etc.</li>
</ul>
<p>The following PHP script demonstrates several such countermeasures combined in a Defence in Depth manner:</p>
<pre>
if (strpos($_SERVER['HTTP_REFERER'], 'https://DiD/') !== 0)
  session_destroy();

if (isset($_GET['LOGOUT'])) 
  session_destroy();

if ($_SERVER['REMOTE_ADDR'] !== $_SESSION['PREV_REMOTEADDR']) 
  session_destroy(); 

if ($_SERVER['HTTP_USER_AGENT'] !== $_SESSION['PREV_USERAGENT'])
  session_destroy();

session_regenerate_id(); // generate a new session identifier

$_SESSION['PREV_USERAGENT'] = $_SERVER['HTTP_USER_AGENT'];
$_SESSION['PREV_REMOTEADDR'] = $_SERVER['REMOTE_ADDR'];
</pre>
<p><a name="See_also" id="See_also"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=17" title="Edit section: See also">edit</a>]</span> <span class="mw-headline">See also</span></h2>
<ul>
<li><a href="/wiki/Session_poisoning" title="Session poisoning">Session poisoning</a></li>
<li><a href="/wiki/Cross-calation" title="Cross-calation" class="mw-redirect">Cross-calation</a></li>
</ul>
<p><a name="External_links" id="External_links"></a></p>
<h2><span class="editsection">[<a href="/w/index.php?title=Session_fixation&amp;action=edit&amp;section=18" title="Edit section: External links">edit</a>]</span> <span class="mw-headline">External links</span></h2>
<ul>
<li><a href="http://shiflett.org/articles/session-fixation" class="external text" title="http://shiflett.org/articles/session-fixation" rel="nofollow">Security Corner: Session Fixation</a></li>
<li><a href="http://www.acros.si/papers/session_fixation.pdf" class="external text" title="http://www.acros.si/papers/session_fixation.pdf" rel="nofollow">Session Fixation Vulnerability in Web-based Applications</a> (PDF)</li>
<li><a href="http://revver.com/video/470597/what-is-session-fixation/" class="external text" title="http://revver.com/video/470597/what-is-session-fixation/" rel="nofollow">Session Fixation Video example</a></li>
</ul>


<!-- 
NewPP limit report
Preprocessor node count: 112/1000000
Post-expand include size: 0/2048000 bytes
Template argument size: 0/2048000 bytes
Expensive parser function count: 0/500
-->

<!-- Saved in parser cache with key enwiki:pcache:idhash:3764708-0!1!0!default!!en!2 and timestamp 20090427205533 -->
<div class="printfooter">
Retrieved from "<a href="http://en.wikipedia.org/wiki/Session_fixation">http://en.wikipedia.org/wiki/Session_fixation</a>"</div>
			<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Categories</a>:&#32;<span dir='ltr'><a href="/wiki/Category:Web_security_exploits" title="Category:Web security exploits">Web security exploits</a></span></div><div id="mw-hidden-catlinks" class="mw-hidden-cats-hidden">Hidden categories:&#32;<span dir='ltr'><a href="/wiki/Category:Articles_with_Alice_and_Bob_explanations" title="Category:Articles with Alice and Bob explanations">Articles with Alice and Bob explanations</a></span></div></div>			<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="/wiki/Session_fixation" title="View the content page [c]" accesskey="c">Article</a></li>
				 <li id="ca-talk"><a href="/wiki/Talk:Session_fixation" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-edit"><a href="/w/index.php?title=Session_fixation&amp;action=edit" title="You can edit this page. &#10;Please use the preview button before saving. [e]" accesskey="e">Edit this page</a></li>
				 <li id="ca-history"><a href="/w/index.php?title=Session_fixation&amp;action=history" title="Past versions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Session_fixation" title="You are encouraged to log in; however, it is not mandatory. [o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(http://upload.wikimedia.org/wikipedia/en/b/bc/Wiki.png);" href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-contents"><a href="/wiki/Portal:Contents" title="Guides to browsing Wikipedia">Contents</a></li>
				<li id="n-featuredcontent"><a href="/wiki/Portal:Featured_content" title="Featured content — the best of Wikipedia">Featured content</a></li>
				<li id="n-currentevents"><a href="/wiki/Portal:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random article [x]" accesskey="x">Random article</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/w/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search Wikipedia [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if one exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search Wikipedia for this text" />
			</div></form>
		</div>
	</div>
	<div class='generated-sidebar portlet' id='p-interaction'>
		<h5>Interaction</h5>
		<div class='pBody'>
			<ul>
				<li id="n-aboutsite"><a href="/wiki/Wikipedia:About" title="Find out about Wikipedia">About Wikipedia</a></li>
				<li id="n-portal"><a href="/wiki/Wikipedia:Community_portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-contact"><a href="/wiki/Wikipedia:Contact_us" title="How to contact Wikipedia">Contact Wikipedia</a></li>
				<li id="n-sitesupport"><a href="http://wikimediafoundation.org/wiki/Donate" title="Support us">Donate to Wikipedia</a></li>
				<li id="n-help"><a href="/wiki/Help:Contents" title="Guidance on how to use and edit Wikipedia">Help</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/Session_fixation" title="List of all English Wikipedia pages containing links to this page [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/Session_fixation" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-upload"><a href="/wiki/Wikipedia:Upload" title="Upload files [u]" accesskey="u">Upload file</a></li>
<li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/w/index.php?title=Session_fixation&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="/w/index.php?title=Session_fixation&amp;oldid=286037851" title="Permanent link to this version of the page">Permanent link</a></li><li id="t-cite"><a href="/w/index.php?title=Special:Cite&amp;page=Session_fixation&amp;id=286037851">Cite this page</a></li>			</ul>
		</div>
	</div>
	<div id="p-lang" class="portlet">
		<h5>Languages</h5>
		<div class="pBody">
			<ul>
				<li class="interwiki-de"><a href="http://de.wikipedia.org/wiki/Session_Fixation">Deutsch</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/skins-1.5/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
				<div id="f-copyrightico"><a href="http://wikimediafoundation.org/"><img src="/images/wikimedia-button.png" border="0" alt="Wikimedia Foundation"/></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 25 April 2009, at 13:23 (UTC).</li>
					<li id="copyright">All text is available under the terms of the <a class='internal' href="http://en.wikipedia.org/wiki/Wikipedia:Text_of_the_GNU_Free_Documentation_License" title="Wikipedia:Text of the GNU Free Documentation License">GNU Free Documentation License</a>. (See <b><a class='internal' href="http://en.wikipedia.org/wiki/Wikipedia:Copyrights" title="Wikipedia:Copyrights">Copyrights</a></b> for details.) <br /> Wikipedia&reg; is a registered trademark of the <a href="http://www.wikimediafoundation.org">Wikimedia Foundation, Inc.</a>, a U.S. registered <a class='internal' href="http://en.wikipedia.org/wiki/501%28c%29#501.28c.29.283.29" title="501(c)(3)">501(c)(3)</a> <a href="http://wikimediafoundation.org/wiki/Deductibility_of_donations">tax-deductible</a> <a class='internal' href="http://en.wikipedia.org/wiki/Non-profit_organization" title="Non-profit organization">nonprofit</a> <a href="http://en.wikipedia.org/wiki/Charitable_organization" title="Charitable organization">charity</a>.<br /></li>
					<li id="privacy"><a href="http://wikimediafoundation.org/wiki/Privacy_policy" title="wikimedia:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="/wiki/Wikipedia:About" title="Wikipedia:About">About Wikipedia</a></li>
					<li id="disclaimer"><a href="/wiki/Wikipedia:General_disclaimer" title="Wikipedia:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served by srv70 in 0.065 secs. --></body></html>
